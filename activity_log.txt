
#1

Tried following instructions at:

https://superset.apache.org/docs/installation/installing-superset-using-docker-compose/

...didn't work

Moved on to instructions at:

https://hub.docker.com/r/apache/superset

...more success, was able to login, see some sample data.

Stopped container. Realised need to connect to real SQL database to import custom data.


#2

Installed Postgres DB to host.

Began building Dockerfile with hopes of connecting to Postgres DB on host.

Used the dependency list at:

https://superset.apache.org/docs/databases/installing-database-drivers

Found guides for opening up Postgres to new connections:

https://superset.apache.org/docs/installation/installing-superset-using-docker-compose/

^ at bottom of page

https://gist.github.com/MauricioMoraes/87d76577babd4e084cba70f63c04b07d

...they worked!


#3

Began setting up Postgres DB.

https://www.digitalocean.com/community/tutorials/how-to-install-postgresql-on-ubuntu-20-04-quickstart

Checked v14 is actually officially supported by Superset (phew, it is)

https://superset.apache.org/docs/installation/configuring-superset

t $  sudo -i -u postgres 

postgres $  createdb test_db

# useradd test_db

Opting to share network with host to keep localhost connections simple, connecting via localhost:8088.

So to build and run:

$ cd ~/superset_experiment.git/

t $ docker build .

t $ docker run -d  --network=host --name 405bd7434a1e

postgres $ psql

postgres=# CREATE USER test_superset WITH PASSWORD 'secret_password';

Then connect to it via GUI. The container is now connected to the DB!

t $ docker commit __________ apache/superset:dockerfile_psql

Then to run at startup:

t $ docker run -d  --network=host apache/superset:dockerfile_psql



#4

Onto sourcing some data.

Went for data from data.police.uk

Downloaded a data set of all police forces 2022, and checked it out manually.

Found the GMP data was incomplete - 2022-08 only, only 1 crime featured.

Went directly to gmp.police.uk website, but data was more about stats of police behavior.

Tried to find info about a specific stabbing on police's own website but did not appear.

Tried earlier data of 2020, but the .zip was empty

Moved on to Essex 2022-12 data, found it is more comprehensive.


#5

Onto importing data.

Found tutorial:

https://www.postgresqltutorial.com/postgresql-tutorial/import-csv-file-into-posgresql-table/

And examples in official docs:

https://www.postgresql.org/docs/current/sql-createtable.html

Put SQL commands into a file, generated a table that fits CSV with:

$ psql -d test_db -a -f /tmp/create_table_police_data.sql

Imported CSV to table with:

$ psql -d test_db

COPY crime_data_essex(crime_id, month, reported_by, falls_within, longitude, latitude, location, lsoa_c, lsoa_n, type, last_outcome, context)
FROM '/tmp/2022_12_essex_crimes_by_street.csv'
DELIMITER ','
CSV HEADER;

OK the data appears to have fit OK, when running:

postgres=# SELECT longitude,latitude FROM crime_data_essex;

Hit some permission errors when trying to access via Supetset, found fix at:

https://www.postgresql.r2schools.com/error-permission-denied-for-table-table_name-in-postgresql/

GRANT ALL PRIVILEGES ON TABLE crime_data_essex TO test_superset;

Data is now accessible from within Apache Superset!


#6

Onto visualising data...

Would like to use co-ordinates to plot to map.

Fixing a mistake in column naming (used a generic Postgres value name	):

test_db=# ALTER TABLE crime_data_essex
test_db-# RENAME COLUMN type TO crime_type;

Created a dataset of violence crime via SQL statement:

SELECT longitude,latitude,crime_type FROM crime_data_essex WHERE crime_type LIKE 'Violence%';

There has been a mismatch between expected data types, whilst trying to plot to a map.
A weakness of Superset is it doesn't tell you what data type the chart is expecting?

Found a recommendation for data types at:

https://stackoverflow.com/questions/1196415/what-datatype-to-use-when-storing-latitude-and-longitude-data-in-sql-databases
